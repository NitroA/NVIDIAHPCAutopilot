
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../assets/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.0, mkdocs-material-8.5.6" name="generator"/>
<title>Neural Networks - Nvidia HPC Autopilot</title>
<link href="../assets/stylesheets/main.20d9efc8.min.css" rel="stylesheet"/>
<link href="../assets/stylesheets/palette.cbb835fc.min.css" rel="stylesheet"/>
<style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.5 7.775V2.75a.25.25 0 0 1 .25-.25h5.025a.25.25 0 0 1 .177.073l6.25 6.25a.25.25 0 0 1 0 .354l-5.025 5.025a.25.25 0 0 1-.354 0l-6.25-6.25a.25.25 0 0 1-.073-.177zm-1.5 0V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.75 1.75 0 0 1 1 7.775zM6 5a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></svg>');--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M2.5 1.75a.25.25 0 0 1 .25-.25h8.5a.25.25 0 0 1 .25.25v7.736a.75.75 0 1 0 1.5 0V1.75A1.75 1.75 0 0 0 11.25 0h-8.5A1.75 1.75 0 0 0 1 1.75v11.5c0 .966.784 1.75 1.75 1.75h3.17a.75.75 0 0 0 0-1.5H2.75a.25.25 0 0 1-.25-.25V1.75zM4.75 4a.75.75 0 0 0 0 1.5h4.5a.75.75 0 0 0 0-1.5h-4.5zM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75zm11.774 3.537a.75.75 0 0 0-1.048-1.074L10.7 14.145 9.281 12.72a.75.75 0 0 0-1.062 1.058l1.943 1.95a.75.75 0 0 0 1.055.008l4.557-4.45z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm6.5-.25A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75zM8 6a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.489 4.489 0 0 1-.563-1.191 3.833 3.833 0 0 1-.05-2.063 4.636 4.636 0 0 1-2.025-.293.75.75 0 1 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.748.748 0 0 1 1.06 0 .75.75 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.404 2.404 0 0 1-.507-.441 3.063 3.063 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.753.753 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768a85.08 85.08 0 0 0-.317-.265c-.814-.68-1.75-1.462-2.692-2.619a3.74 3.74 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.75.75 0 0 1 1.06-1.06L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13zM0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm9 3a1 1 0 1 1-2 0 1 1 0 0 1 2 0zM6.92 6.085c.081-.16.19-.299.34-.398.145-.097.371-.187.74-.187.28 0 .553.087.738.225A.613.613 0 0 1 9 6.25c0 .177-.04.264-.077.318a.956.956 0 0 1-.277.245c-.076.051-.158.1-.258.161l-.007.004a7.728 7.728 0 0 0-.313.195 2.416 2.416 0 0 0-.692.661.75.75 0 0 0 1.248.832.956.956 0 0 1 .276-.245 6.3 6.3 0 0 1 .26-.16l.006-.004c.093-.057.204-.123.313-.195.222-.149.487-.355.692-.662.214-.32.329-.702.329-1.15 0-.76-.36-1.348-.863-1.725A2.76 2.76 0 0 0 8 4c-.631 0-1.155.16-1.572.438-.413.276-.68.638-.849.977a.75.75 0 1 0 1.342.67z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575L6.457 1.047zM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm-.25-5.25a.75.75 0 0 0-1.5 0v2.5a.75.75 0 0 0 1.5 0v-2.5z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M3.404 12.596a6.5 6.5 0 1 1 9.192-9.192 6.5 6.5 0 0 1-9.192 9.192zM2.344 2.343a8 8 0 1 0 11.313 11.314A8 8 0 0 0 2.343 2.343zM6.03 4.97a.75.75 0 0 0-1.06 1.06L6.94 8 4.97 9.97a.75.75 0 1 0 1.06 1.06L8 9.06l1.97 1.97a.75.75 0 1 0 1.06-1.06L9.06 8l1.97-1.97a.75.75 0 1 0-1.06-1.06L8 6.94 6.03 4.97z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M10.561 1.5a.016.016 0 0 0-.01.004L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.02.02 0 0 0-.004-.009.02.02 0 0 0-.006-.006L10.56 1.5zM9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.25 1.25 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.492 3.492 0 0 1 2.441 0l.999-1a.75.75 0 1 1 1.06 1.061l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.013 5.013 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.684 1.684 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06zM6.173 5h3.654A.173.173 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173zM5.25 6.5a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75h-5.5z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458L5 5.782zM9.5 2.5h-3V6a.75.75 0 0 1-.117.403L4.73 9h6.54L9.617 6.403A.75.75 0 0 1 9.5 6V2.5zm-6.9 9.847L3.775 10.5h8.45l1.175 1.847a.75.75 0 0 1-.633 1.153H3.233a.75.75 0 0 1-.633-1.153z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M1.75 2.5a.75.75 0 0 0 0 1.5h10.5a.75.75 0 0 0 0-1.5H1.75zm4 5a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5zm0 5a.75.75 0 0 0 0 1.5h8.5a.75.75 0 0 0 0-1.5h-8.5zM2.5 7.75a.75.75 0 0 0-1.5 0v6a.75.75 0 0 0 1.5 0v-6z"/></svg>');}</style>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gdesc-inner { font-size: 0.75rem; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                </style><script src="../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#neural-networks">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Nvidia HPC Autopilot" class="md-header__button md-logo" data-md-component="logo" href=".." title="Nvidia HPC Autopilot">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Nvidia HPC Autopilot
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Neural Networks
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"></path></svg>
</label>
</form>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/pfeinsper/NVIDIA" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    pfeinsper/NVIDIA
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Nvidia HPC Autopilot" class="md-nav__button md-logo" data-md-component="logo" href=".." title="Nvidia HPC Autopilot">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    Nvidia HPC Autopilot
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/pfeinsper/NVIDIA" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    pfeinsper/NVIDIA
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="..">
        Getting Started
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../usage/">
        Usage
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../autopilot/">
        Autopilot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../control/">
        Control
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../dataset/">
        Dataset
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          Neural Networks
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Neural Networks
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#model-overview">
    Model Overview
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building-the-model">
    Building the model
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#model-usage">
    Model Usage
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#detailed-transfer-learning">
    Detailed Transfer Learning
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../mqtt/">
        Broker MQTT
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../reference/">
        Reference
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#model-overview">
    Model Overview
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#building-the-model">
    Building the model
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#model-usage">
    Model Usage
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#detailed-transfer-learning">
    Detailed Transfer Learning
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/pfeinsper/NVIDIA/edit/master/docs/network.md" title="Edit this page">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"></path></svg>
</a>
<h1 id="neural-networks">Neural Networks</h1>
<p>In this part of the project the neural networks system is basically a detector. This detector network is capable of identifing the traffic signs of the road, crop the traffic sign frame and classify it as a specific class, so that the network model classifies and detects the roadsign and send the information to the Broker MQTT that comunicates with the robot infinite state machine. </p>
<div class="admonition danger">
<p class="admonition-title">REMEMBER</p>
<p>The section that explains the detailed transfer learning you can run in your own computer. But the section of the Model Usage is executed on the docker container mentioned on the Usage page.</p>
</div>
<h2 id="model-overview">Model Overview</h2>
<p>This neural network model is based on a object detection model from Nvidia GPU Cloud called <a href="" title="https://catalog.ngc.nvidia.com/orgs/nvidia/teams/tao/models/dashcamnet">DashCamNet</a>, which is built based on Nvidia <a href="" title="https://catalog.ngc.nvidia.com/orgs/nvidia/resources/tao_detectnet">DetectNet_v2</a> detector which uses ResNet18 and since it is a object detection model, the output is a bounding-box on the input image surrounding the object detected, the bouding-box is predicted by calculating the x center, y center, width and height from the object, not to mention the confidence value from the output class is returned as well.</p>
<p>The model classes identified are:</p>
<ul>
<li>pare (Indicating the stop sign)</li>
<li>40 (Indicating the 40km/h traffic sign)</li>
<li>60 (Indicating the 60km/h traffic sign)</li>
</ul>
<h2 id="building-the-model">Building the model</h2>
<p>The model was created using the transfer learning toolkit from Nvidia called <a href="" title="https://developer.nvidia.com/tao-toolkit">TAO Toolkit</a> with a <a href="" title="https://roboflow.com/">Roboflow Dataset</a>. The raise of the dataset is documented on the <a href="" title="">Dataset</a> section. The main reference used for the traffic sign detector was based on an article called <a href="" title="https://blog.roboflow.com/nvidia-tao-toolkit-roboflow/">Building Custom Computer Vision Models with NVIDIA TAO Toolkit and Roboflow</a> and a repository <a href="" title="https://github.com/roboflow-ai/tao-toolkit-with-roboflow">tao-toolkit-with-roboflow</a> which used TAO toolkit to create a yolo_v4 based model using transfer learning.</p>
<p>In our case the steps were the same but the neural networks detector used was DetectNet_v2 instead of yolo_v4.</p>
<p>The notebook from our project is on Github on this link:</p>
<ul>
<li><strong><a href="" title="https://github.com/pfeinsper/NVIDIA/blob/main/transfer-learning/transfer_learning_tutorial.ipynb">Project Notebook</a></strong></li>
</ul>
<h2 id="model-usage">Model Usage</h2>
<p>If you want to just use our model, you can just download these files below on your Jetson device, on the other hand, if you want to build your own model you can follow the Detailed Transfer learning section below:</p>
<table>
<thead>
<tr>
<th>Files</th>
<th>Links</th>
</tr>
</thead>
<tbody>
<tr>
<td>Etlt model</td>
<td><a href="" title="https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J">https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J</a></td>
</tr>
<tr>
<td>Labels file</td>
<td><a href="" title="https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J">https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J</a></td>
</tr>
<tr>
<td>Calibration file</td>
<td><a href="" title="https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J">https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J</a></td>
</tr>
<tr>
<td>Engine file</td>
<td><a href="" title="https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J">https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J</a></td>
</tr>
</tbody>
</table>
<p>After downloading these files you need to create a <code>config_primary.txt</code> file with the content below:</p>
<div class="highlight"><pre><span></span><code>[property]
gpu-id=0
net-scale-factor=0.0039215697906911373
int8-calib-file=&lt;Path to optional INT8 calibration cache&gt;
labelfile-path=&lt;Path to labels.txt&gt;
tlt-encoded-model=&lt;Path to ETLT model&gt;
tlt-model-key=&lt;Key to decrypt the model&gt;
infer-dims=c;h;w # where c = number of channels, h = height of the model input, w = width of model input
force-implicit-batch-dim=1
batch-size=1
network-mode=1
num-detected-classes=3
interval=0
gie-unique-id=1
output-blob-names=conv2d_bbox;conv2d_cov/Sigmoid
#scaling-filter=0
#scaling-compute-hw=0

[class-attrs-all]
pre-cluster-threshold=0.2
eps=0.2
group-threshold=1
</code></pre></div>
<p>Create a python file called <code>deepstream_usb_camera_with_custom_model.py</code> to run the model:</p>
<div class="admonition danger">
<p class="admonition-title">REMEMBER</p>
<p>For this step you need to have the Broker MQTT, Deepstream and your current IP ADDRESS.</p>
</div>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>
<span class="kn">from</span> <span class="nn">paho.mqtt</span> <span class="kn">import</span> <span class="n">client</span> <span class="k">as</span> <span class="n">mqtt_client</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">'../'</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">gi</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">configparser</span>
<span class="n">gi</span><span class="o">.</span><span class="n">require_version</span><span class="p">(</span><span class="s1">'Gst'</span><span class="p">,</span> <span class="s1">'1.0'</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">gi.repository</span> <span class="kn">import</span> <span class="n">GObject</span><span class="p">,</span> <span class="n">Gst</span>
<span class="kn">from</span> <span class="nn">common.is_aarch_64</span> <span class="kn">import</span> <span class="n">is_aarch64</span>
<span class="kn">from</span> <span class="nn">common.bus_call</span> <span class="kn">import</span> <span class="n">bus_call</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="kn">import</span> <span class="nn">pyds</span>

<span class="n">PGIE_CLASS_ID_PARE</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">PGIE_CLASS_ID_40</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">PGIE_CLASS_ID_60</span> <span class="o">=</span> <span class="mi">2</span>


<span class="n">broker</span> <span class="o">=</span> <span class="s1">'YOUR_MACHINE_IP_ADDRESS'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">1884</span>
<span class="n">topic</span> <span class="o">=</span> <span class="s2">"python/mqtt"</span>
<span class="n">client_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'python-mqtt-</span><span class="si">{</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span><span class="si">}</span><span class="s1">'</span>
<span class="k">def</span> <span class="nf">connect_mqtt</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">on_connect</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">flags</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">rc</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Connected to MQTT Broker!"</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">"Failed to connect, return code </span><span class="si">%d</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="n">rc</span><span class="p">)</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">mqtt_client</span><span class="o">.</span><span class="n">Client</span><span class="p">(</span><span class="n">client_id</span><span class="p">)</span>
    <span class="n">client</span><span class="o">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="n">on_connect</span>
    <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">broker</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">client</span>


<span class="k">def</span> <span class="nf">publish</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
    <span class="c1"># result: [0, 1]</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Send </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Failed to send message to topic </span><span class="si">{</span><span class="n">topic</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">connect_mqtt</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">loop_start</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">osd_sink_pad_buffer_probe</span><span class="p">(</span><span class="n">pad</span><span class="p">,</span><span class="n">info</span><span class="p">,</span><span class="n">u_data</span><span class="p">):</span>
    <span class="n">frame_number</span><span class="o">=</span><span class="mi">0</span>
    <span class="c1">#Intiallizing object counter with 0.</span>
    <span class="n">obj_counter</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">PGIE_CLASS_ID_PARE</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">PGIE_CLASS_ID_60</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">PGIE_CLASS_ID_40</span><span class="p">:</span><span class="mi">0</span>
    <span class="p">}</span>
    <span class="n">num_rects</span><span class="o">=</span><span class="mi">0</span>
    <span class="n">x_left</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">x_right</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">y_top</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">y_bottom</span> <span class="o">=</span> <span class="mi">0</span> 
    <span class="n">area</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">roadsign_detected</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">gst_buffer</span> <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get_buffer</span><span class="p">()</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">gst_buffer</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Unable to get GstBuffer "</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Retrieve batch metadata from the gst_buffer</span>
    <span class="c1"># Note that pyds.gst_buffer_get_nvds_batch_meta() expects the</span>
    <span class="c1"># C address of gst_buffer as input, which is obtained with hash(gst_buffer)</span>
    <span class="n">batch_meta</span> <span class="o">=</span> <span class="n">pyds</span><span class="o">.</span><span class="n">gst_buffer_get_nvds_batch_meta</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="n">gst_buffer</span><span class="p">))</span>
    <span class="n">l_frame</span> <span class="o">=</span> <span class="n">batch_meta</span><span class="o">.</span><span class="n">frame_meta_list</span>
    <span class="k">while</span> <span class="n">l_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Note that l_frame.data needs a cast to pyds.NvDsFrameMeta</span>
            <span class="c1"># The casting is done by pyds.NvDsFrameMeta.cast()</span>
            <span class="c1"># The casting also keeps ownership of the underlying memory</span>
            <span class="c1"># in the C code, so the Python garbage collector will leave</span>
            <span class="c1"># it alone.</span>
           <span class="n">frame_meta</span> <span class="o">=</span> <span class="n">pyds</span><span class="o">.</span><span class="n">NvDsFrameMeta</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">l_frame</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="n">frame_number</span><span class="o">=</span><span class="n">frame_meta</span><span class="o">.</span><span class="n">frame_num</span>
        <span class="n">num_rects</span> <span class="o">=</span> <span class="n">frame_meta</span><span class="o">.</span><span class="n">num_obj_meta</span>
        <span class="n">l_obj</span><span class="o">=</span><span class="n">frame_meta</span><span class="o">.</span><span class="n">obj_meta_list</span>
        <span class="k">while</span> <span class="n">l_obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Casting l_obj.data to pyds.NvDsObjectMeta</span>
                <span class="n">obj_meta</span><span class="o">=</span><span class="n">pyds</span><span class="o">.</span><span class="n">NvDsObjectMeta</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">l_obj</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">'Detected "'</span> <span class="o">+</span> <span class="n">obj_meta</span><span class="o">.</span><span class="n">obj_label</span> <span class="o">+</span> <span class="s1">'" with ID: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj_meta</span><span class="o">.</span><span class="n">object_id</span><span class="p">))</span>

            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">obj_counter</span><span class="p">[</span><span class="n">obj_meta</span><span class="o">.</span><span class="n">class_id</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">l_obj</span><span class="o">=</span><span class="n">l_obj</span><span class="o">.</span><span class="n">next</span>
            <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Acquiring a display meta object. The memory ownership remains in</span>
        <span class="c1"># the C code so downstream plugins can still access it. Otherwise</span>
        <span class="c1"># the garbage collector will claim it when this probe function exits.</span>

        <span class="n">display_meta</span><span class="o">=</span><span class="n">pyds</span><span class="o">.</span><span class="n">nvds_acquire_display_meta_from_pool</span><span class="p">(</span><span class="n">batch_meta</span><span class="p">)</span>
        <span class="n">display_meta</span><span class="o">.</span><span class="n">num_labels</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">py_nvosd_text_params</span> <span class="o">=</span> <span class="n">display_meta</span><span class="o">.</span><span class="n">text_params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Setting display text to be shown on screen</span>
        <span class="c1"># Note that the pyds module allocates a buffer for the string, and the</span>
        <span class="c1"># memory will not be claimed by the garbage collector.</span>
        <span class="c1"># Reading the display_text field here will return the C address of the</span>
        <span class="c1"># allocated string. Use pyds.get_string() to get the string content.</span>

        <span class="k">if</span> <span class="n">obj_counter</span><span class="p">[</span><span class="n">PGIE_CLASS_ID_ROADSIGN</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x_left</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_meta</span><span class="o">.</span><span class="n">rect_params</span><span class="o">.</span><span class="n">left</span><span class="p">)</span>
            <span class="n">x_right</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_meta</span><span class="o">.</span><span class="n">rect_params</span><span class="o">.</span><span class="n">left</span> <span class="o">+</span> <span class="n">obj_meta</span><span class="o">.</span><span class="n">rect_params</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
            <span class="n">y_top</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">obj_meta</span><span class="o">.</span><span class="n">rect_params</span><span class="o">.</span><span class="n">top</span><span class="p">)</span>
            <span class="n">y_bottom</span> <span class="o">=</span>  <span class="nb">int</span><span class="p">(</span><span class="n">obj_meta</span><span class="o">.</span><span class="n">rect_params</span><span class="o">.</span><span class="n">top</span> <span class="o">+</span> <span class="n">obj_meta</span><span class="o">.</span><span class="n">rect_params</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>
            <span class="n">area</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x_right</span> <span class="o">-</span> <span class="n">x_left</span><span class="p">)</span><span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">y_bottom</span> <span class="o">-</span> <span class="n">y_top</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">area</span> <span class="o">&gt;</span> <span class="mi">38000</span><span class="p">:</span>
                <span class="n">roadsign_detected</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">roadsign_detected</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">py_nvosd_text_params</span><span class="o">.</span><span class="n">display_text</span> <span class="o">=</span> <span class="s2">"DeepStream </span><span class="si">{0}</span><span class="s2">"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">roadsign_detected</span><span class="p">)</span>

        <span class="c1"># Now set the offsets where the string should appear</span>
        <span class="n">py_nvosd_text_params</span><span class="o">.</span><span class="n">x_offset</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">py_nvosd_text_params</span><span class="o">.</span><span class="n">y_offset</span> <span class="o">=</span> <span class="mi">12</span>

        <span class="c1"># Font , font-color and font-size</span>
        <span class="n">py_nvosd_text_params</span><span class="o">.</span><span class="n">font_params</span><span class="o">.</span><span class="n">font_name</span> <span class="o">=</span> <span class="s2">"Serif"</span>
        <span class="n">py_nvosd_text_params</span><span class="o">.</span><span class="n">font_params</span><span class="o">.</span><span class="n">font_size</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="c1"># set(red, green, blue, alpha); set to White</span>
        <span class="n">py_nvosd_text_params</span><span class="o">.</span><span class="n">font_params</span><span class="o">.</span><span class="n">font_color</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>

        <span class="c1"># Text background color</span>
        <span class="n">py_nvosd_text_params</span><span class="o">.</span><span class="n">set_bg_clr</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># set(red, green, blue, alpha); set to Black</span>
        <span class="n">py_nvosd_text_params</span><span class="o">.</span><span class="n">text_bg_clr</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># Using pyds.get_string() to get display_text as string</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">pyds</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">py_nvosd_text_params</span><span class="o">.</span><span class="n">display_text</span><span class="p">))</span>
        <span class="n">publish</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">pyds</span><span class="o">.</span><span class="n">get_string</span><span class="p">(</span><span class="n">py_nvosd_text_params</span><span class="o">.</span><span class="n">display_text</span><span class="p">))</span>
        <span class="n">pyds</span><span class="o">.</span><span class="n">nvds_add_display_meta_to_frame</span><span class="p">(</span><span class="n">frame_meta</span><span class="p">,</span> <span class="n">display_meta</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">l_frame</span><span class="o">=</span><span class="n">l_frame</span><span class="o">.</span><span class="n">next</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">Gst</span><span class="o">.</span><span class="n">PadProbeReturn</span><span class="o">.</span><span class="n">OK</span>    


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
    <span class="c1"># Check input arguments</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">"usage: </span><span class="si">%s</span><span class="s2"> &lt;v4l2-device-path&gt;</span><span class="se">\n</span><span class="s2">"</span> <span class="o">%</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Standard GStreamer initialization</span>
    <span class="n">GObject</span><span class="o">.</span><span class="n">threads_init</span><span class="p">()</span>
    <span class="n">Gst</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Create gstreamer elements</span>
    <span class="c1"># Create Pipeline element that will form a connection of other elements</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Creating Pipeline </span><span class="se">\n</span><span class="s2"> "</span><span class="p">)</span>
    <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">pipeline</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create Pipeline </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Source element for reading from the file</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Creating Source </span><span class="se">\n</span><span class="s2"> "</span><span class="p">)</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"v4l2src"</span><span class="p">,</span> <span class="s2">"usb-cam-source"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create Source </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">caps_v4l2src</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"capsfilter"</span><span class="p">,</span> <span class="s2">"v4l2src_caps"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">caps_v4l2src</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create v4l2src capsfilter </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>


    <span class="nb">print</span><span class="p">(</span><span class="s2">"Creating Video Converter </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Adding videoconvert -&gt; nvvideoconvert as not all</span>
    <span class="c1"># raw formats are supported by nvvideoconvert;</span>
    <span class="c1"># Say YUYV is unsupported - which is the common</span>
    <span class="c1"># raw format for many logi usb cams</span>
    <span class="c1"># In case we have a camera with raw format supported in</span>
    <span class="c1"># nvvideoconvert, GStreamer plugins' capability negotiation</span>
    <span class="c1"># shall be intelligent enough to reduce compute by</span>
    <span class="c1"># videoconvert doing passthrough (TODO we need to confirm this)</span>


    <span class="c1"># videoconvert to make sure a superset of raw formats are supported</span>
    <span class="n">vidconvsrc</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"videoconvert"</span><span class="p">,</span> <span class="s2">"convertor_src1"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">vidconvsrc</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create videoconvert </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># nvvideoconvert to convert incoming raw buffers to NVMM Mem (NvBufSurface API)</span>
    <span class="n">nvvidconvsrc</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"nvvideoconvert"</span><span class="p">,</span> <span class="s2">"convertor_src2"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">nvvidconvsrc</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create Nvvideoconvert </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">caps_vidconvsrc</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"capsfilter"</span><span class="p">,</span> <span class="s2">"nvmm_caps"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">caps_vidconvsrc</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create capsfilter </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Create nvstreammux instance to form batches from one or more sources.</span>
    <span class="n">streammux</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"nvstreammux"</span><span class="p">,</span> <span class="s2">"Stream-muxer"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">streammux</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create NvStreamMux </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Use nvinfer to run inferencing on camera's output,</span>
    <span class="c1"># behaviour of inferencing is set through config file</span>
    <span class="n">pgie</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"nvinfer"</span><span class="p">,</span> <span class="s2">"primary-inference"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pgie</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create pgie </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Use nvtracker to give objects unique-ids</span>
    <span class="n">tracker</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"nvtracker"</span><span class="p">,</span> <span class="s2">"tracker"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pgie</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create tracker </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Use convertor to convert from NV12 to RGBA as required by nvosd</span>
    <span class="n">nvvidconv</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"nvvideoconvert"</span><span class="p">,</span> <span class="s2">"convertor"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">nvvidconv</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create nvvidconv </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Create OSD to draw on the converted RGBA buffer</span>
    <span class="n">nvosd</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"nvdsosd"</span><span class="p">,</span> <span class="s2">"onscreendisplay"</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">nvosd</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create nvosd </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="c1"># Finally render the osd output</span>
    <span class="k">if</span> <span class="n">is_aarch64</span><span class="p">():</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"nvegltransform"</span><span class="p">,</span> <span class="s2">"nvegl-transform"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Creating EGLSink </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">sink</span> <span class="o">=</span> <span class="n">Gst</span><span class="o">.</span><span class="n">ElementFactory</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s2">"nveglglessink"</span><span class="p">,</span> <span class="s2">"nvvideo-renderer"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sink</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to create egl sink </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Playing cam </span><span class="si">%s</span><span class="s2"> "</span> <span class="o">%</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">caps_v4l2src</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'caps'</span><span class="p">,</span> <span class="n">Gst</span><span class="o">.</span><span class="n">Caps</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">"video/x-raw, framerate=30/1"</span><span class="p">))</span>
    <span class="n">caps_vidconvsrc</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'caps'</span><span class="p">,</span> <span class="n">Gst</span><span class="o">.</span><span class="n">Caps</span><span class="o">.</span><span class="n">from_string</span><span class="p">(</span><span class="s2">"video/x-raw(memory:NVMM)"</span><span class="p">))</span>
    <span class="n">source</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'device'</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">streammux</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'width'</span><span class="p">,</span> <span class="mi">1920</span><span class="p">)</span>
    <span class="n">streammux</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'height'</span><span class="p">,</span> <span class="mi">1080</span><span class="p">)</span>
    <span class="n">streammux</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'batch-size'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">streammux</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'batched-push-timeout'</span><span class="p">,</span> <span class="mi">4000000</span><span class="p">)</span>
    <span class="n">pgie</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'config-file-path'</span><span class="p">,</span> <span class="s2">"config_primary.txt"</span><span class="p">)</span>
    <span class="c1">#Set properties of tracker from tracker_config</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">configparser</span><span class="o">.</span><span class="n">ConfigParser</span><span class="p">()</span>
    <span class="n">config</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">'../deepstream-test2/dstest2_tracker_config.txt'</span><span class="p">)</span>
    <span class="n">config</span><span class="o">.</span><span class="n">sections</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">config</span><span class="p">[</span><span class="s1">'tracker'</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'tracker-width'</span> <span class="p">:</span>
            <span class="n">tracker_width</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">'tracker'</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'tracker-width'</span><span class="p">,</span> <span class="n">tracker_width</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'tracker-height'</span> <span class="p">:</span>
            <span class="n">tracker_height</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">'tracker'</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'tracker-height'</span><span class="p">,</span> <span class="n">tracker_height</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'gpu-id'</span> <span class="p">:</span>
            <span class="n">tracker_gpu_id</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">'tracker'</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'gpu_id'</span><span class="p">,</span> <span class="n">tracker_gpu_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'ll-lib-file'</span> <span class="p">:</span>
            <span class="n">tracker_ll_lib_file</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'tracker'</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'ll-lib-file'</span><span class="p">,</span> <span class="n">tracker_ll_lib_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'ll-config-file'</span> <span class="p">:</span>
            <span class="n">tracker_ll_config_file</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'tracker'</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'ll-config-file'</span><span class="p">,</span> <span class="n">tracker_ll_config_file</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'enable-batch-process'</span> <span class="p">:</span>
            <span class="n">tracker_enable_batch_process</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">getint</span><span class="p">(</span><span class="s1">'tracker'</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">tracker</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'enable_batch_process'</span><span class="p">,</span> <span class="n">tracker_enable_batch_process</span><span class="p">)</span>
    <span class="c1"># Set sync = false to avoid late frame drops at the display-sink</span>
    <span class="n">sink</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="s1">'sync'</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Adding elements to Pipeline </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">caps_v4l2src</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">vidconvsrc</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nvvidconvsrc</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">caps_vidconvsrc</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">streammux</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pgie</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tracker</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nvvidconv</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">nvosd</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sink</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_aarch64</span><span class="p">():</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>

    <span class="c1"># we link the elements together</span>
    <span class="c1"># v4l2src -&gt; nvvideoconvert -&gt; mux -&gt; </span>
    <span class="c1"># nvinfer -&gt; nvvideoconvert -&gt; nvosd -&gt; video-renderer</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Linking elements in the Pipeline </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">source</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">caps_v4l2src</span><span class="p">)</span>
    <span class="n">caps_v4l2src</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">vidconvsrc</span><span class="p">)</span>
    <span class="n">vidconvsrc</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">nvvidconvsrc</span><span class="p">)</span>
    <span class="n">nvvidconvsrc</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">caps_vidconvsrc</span><span class="p">)</span>

    <span class="n">sinkpad</span> <span class="o">=</span> <span class="n">streammux</span><span class="o">.</span><span class="n">get_request_pad</span><span class="p">(</span><span class="s2">"sink_0"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sinkpad</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to get the sink pad of streammux </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">srcpad</span> <span class="o">=</span> <span class="n">caps_vidconvsrc</span><span class="o">.</span><span class="n">get_static_pad</span><span class="p">(</span><span class="s2">"src"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">srcpad</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to get source pad of caps_vidconvsrc </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">srcpad</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sinkpad</span><span class="p">)</span>
    <span class="n">streammux</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">pgie</span><span class="p">)</span>
    <span class="n">pgie</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">tracker</span><span class="p">)</span>
    <span class="n">tracker</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">nvvidconv</span><span class="p">)</span>
    <span class="n">nvvidconv</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">nvosd</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_aarch64</span><span class="p">():</span>
        <span class="n">nvosd</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
        <span class="n">transform</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sink</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nvosd</span><span class="o">.</span><span class="n">link</span><span class="p">(</span><span class="n">sink</span><span class="p">)</span>

    <span class="c1"># create an event loop and feed gstreamer bus mesages to it</span>
    <span class="n">loop</span> <span class="o">=</span> <span class="n">GObject</span><span class="o">.</span><span class="n">MainLoop</span><span class="p">()</span>
    <span class="n">bus</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">get_bus</span><span class="p">()</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">add_signal_watch</span><span class="p">()</span>
    <span class="n">bus</span><span class="o">.</span><span class="n">connect</span> <span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="n">bus_call</span><span class="p">,</span> <span class="n">loop</span><span class="p">)</span>

    <span class="c1"># Lets add probe to get informed of the meta data generated, we add probe to</span>
    <span class="c1"># the sink pad of the osd element, since by that time, the buffer would have</span>
    <span class="c1"># had got all the metadata.</span>
    <span class="n">osdsinkpad</span> <span class="o">=</span> <span class="n">nvosd</span><span class="o">.</span><span class="n">get_static_pad</span><span class="p">(</span><span class="s2">"sink"</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">osdsinkpad</span><span class="p">:</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">" Unable to get sink pad of nvosd </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">osdsinkpad</span><span class="o">.</span><span class="n">add_probe</span><span class="p">(</span><span class="n">Gst</span><span class="o">.</span><span class="n">PadProbeType</span><span class="o">.</span><span class="n">BUFFER</span><span class="p">,</span> <span class="n">osd_sink_pad_buffer_probe</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="c1"># start play back and listen to events</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Starting pipeline </span><span class="se">\n</span><span class="s2">"</span><span class="p">)</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">Gst</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">PLAYING</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="c1"># cleanup</span>
    <span class="n">pipeline</span><span class="o">.</span><span class="n">set_state</span><span class="p">(</span><span class="n">Gst</span><span class="o">.</span><span class="n">State</span><span class="o">.</span><span class="n">NULL</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">'__main__'</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">))</span>
</code></pre></div>
<p>Finally you can run the python specifing the config file and the usb camera path:</p>
<p><strong>Normally you can test it using <code>/dev/video0</code> for the usb camera path</strong></p>
<div class="highlight"><pre><span></span><code>python3 deepstream_usb_camera_with_custom_model.py /dev/<span class="o">{</span>USB_CAMERA_VIDEO_PATH<span class="o">}</span>
</code></pre></div>
<h2 id="detailed-transfer-learning">Detailed Transfer Learning</h2>
<p>Since you want to build a custom model by yourself you can follow the notebooks from the links below and download the files referenced, so that you can follow the correct steps:</p>
<ul>
<li><a href="" title="https://github.com/roboflow-ai/tao-toolkit-with-roboflow">tao-toolkit-with-roboflow</a> </li>
<li><a href="" title="https://github.com/pfeinsper/NVIDIA/blob/main/transfer-learning/transfer_learning_tutorial.ipynb">Jetbot transfer learning</a></li>
</ul>
<table>
<thead>
<tr>
<th>Files</th>
<th>Links</th>
</tr>
</thead>
<tbody>
<tr>
<td>experiment_spec.json</td>
<td><a href="" title="https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J">"https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J"</a></td>
</tr>
<tr>
<td>detectnet_v2_inference.txt</td>
<td><a href="" title="https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J">"https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J"</a></td>
</tr>
<tr>
<td>detectnet_v2_inference_etlt</td>
<td><a href="" title="https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J">"https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J"</a></td>
</tr>
<tr>
<td>detectnet_v2_retrain_resnet18</td>
<td><a href="" title="https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J">"https://drive.google.com/drive/folders/1TCEeig-Y4BD1gVVE5CkSWjv4DcaY7r4J"</a></td>
</tr>
</tbody>
</table>
<!-- ```bash
pip install nvidia-tao
pip install roboflow
<div class="highlight"><pre><span></span><code>After doing that you need to export the roboflow dataset using the COCO format, you can do it manually or using python code as shown below:

```python
from roboflow import Roboflow
rf = Roboflow(api_key=&quot;YOUR_ROBOFLOW_API_KEY&quot;)
project = rf.workspace(&quot;ROBOFLOW_WORKSPACE&quot;).project(&quot;ROBOFLOW_PROJECT_NAME&quot;)
dataset = project.version(1).download(&quot;coco&quot;)
</code></pre></div>

Since TAO toolkit uses a docker container to run the traning, testing, inference and other machine learning parts, you need to specify the directory path from your project and dataset so that the docker container can access all your project files, for this you can use this python code below:

<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="o">%</span><span class="n">env</span> <span class="n">KEY</span><span class="o">=</span><span class="n">tlt_encode</span>
<span class="o">%</span><span class="n">env</span> <span class="n">NUM_GPUS</span><span class="o">=</span><span class="mi">1</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LOCAL_PROJECT_DIR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;PATH_FROM_YOUR_PROJECT&quot;</span>

<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LOCAL_DATA_DIR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;LOCAL_PROJECT_DIR&quot;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()),</span>
    <span class="s2">&quot;YOUR_DATASET_DIRECTORY&quot;</span>
<span class="p">)</span>
<span class="n">z</span>
<span class="n">mounts_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/.tao_mounts.json&quot;</span><span class="p">)</span>

<span class="c1"># Define the dictionary with the mapped drives</span>
<span class="n">drive_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Mounts&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="c1"># Mapping the data directory</span>
        <span class="p">{</span>
            <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;LOCAL_PROJECT_DIR&quot;</span><span class="p">],</span>
            <span class="s2">&quot;destination&quot;</span><span class="p">:</span> <span class="s2">&quot;/workspace/project&quot;</span>
        <span class="p">},</span>
    <span class="p">],</span>
    <span class="s2">&quot;DockerOptions&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c1"># preserving the same permissions with the docker as in host machine.</span>
        <span class="s2">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">(),</span> <span class="n">os</span><span class="o">.</span><span class="n">getgid</span><span class="p">())</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Writing the mounts file.</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">mounts_file</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">mfile</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">drive_map</span><span class="p">,</span> <span class="n">mfile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div>

<div class="highlight"><pre><span></span><code><span class="n">dataset_config</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">coco_config {</span>
<span class="s2">  root_directory_path: &quot;/workspace/project/YOUR_DATASET_DIRECTORY&quot;</span>
<span class="s2">  img_dir_names: [&quot;test&quot;, &quot;train&quot;, &quot;valid&quot;]</span>
<span class="s2">  annotation_files: [ &quot;test/_annotations.coco.json&quot;, &quot;train/_annotations.coco.json&quot;, &quot;valid/_annotations.coco.json&quot;]</span>
<span class="s2">  num_partitions: 3</span>
<span class="s2">  num_shards: [1, 72, 2]</span>
<span class="s2">}</span>
<span class="s2">image_directory_path: &quot;/workspace/project/YOUR_DATASET_DIRECTORY&quot;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># write the dataset config to a JSON file</span>
<span class="n">file_object</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;coco_config.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
<span class="n">file_object</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dataset_config</span><span class="p">)</span>
<span class="n">file_object</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1">#Verify the coco_config.json file</span>
<span class="err">!</span><span class="n">cat</span> <span class="n">coco_config</span><span class="o">.</span><span class="n">json</span>
</code></pre></div>

You can verify that the docker container can access the project files using this code below:
<div class="highlight"><pre><span></span><code><span class="err">!</span><span class="n">tao</span> <span class="n">bpnet</span> <span class="n">run</span> <span class="n">ls</span> <span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">project</span><span class="o">/</span><span class="n">YOUR_DATASET_DIRECTORY</span><span class="o">/</span><span class="n">test</span>
</code></pre></div>

The next part you need to  -->
</article>
</div>
</div>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Dataset" class="md-footer__link md-footer__link--prev" href="../dataset/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Dataset
            </div>
</div>
</a>
<a aria-label="Next: Broker MQTT" class="md-footer__link md-footer__link--next" href="../mqtt/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Broker MQTT
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
<script src="../assets/javascripts/bundle.078830c0.min.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom"});})</script></body>
</html>